# LifeDeck Backend API

NestJS-based backend API for the LifeDeck life optimization platform.

## Features

- **Authentication**: JWT-based auth with OAuth support (Google, Apple)
- **User Management**: Profile management and preferences
- **AI-Powered Cards**: Personalized coaching cards generated by OpenAI
- **Analytics**: Life score tracking and progress analytics
- **Subscriptions**: Premium subscription management with Stripe
- **Caching**: Redis-based caching for performance
- **Background Jobs**: Bull queues for async processing

## Tech Stack

- **Framework**: NestJS
- **Database**: PostgreSQL with Prisma ORM
- **Authentication**: JWT + Passport
- **AI**: OpenAI API
- **Caching**: Redis
- **Payments**: Stripe
- **Queue**: BullMQ

## Getting Started

### Prerequisites

- Node.js 18+
- PostgreSQL 14+
- Redis 6+

### Installation

1. Install dependencies:
```bash
npm install
```

2. Set up environment variables:
```bash
cp .env.example .env
# Edit .env with your configuration
```

3. Set up database:
```bash
npx prisma migrate dev
npx prisma db seed
```

4. Start the development server:
```bash
npm run start:dev
```

The API will be available at `http://localhost:3000/v1`

## API Documentation

The complete API documentation is available in OpenAPI 3.0 format at [`backend/openapi.yaml`](../backend/openapi.yaml)

### Key Endpoints

#### Authentication
- `POST /v1/auth/login` - User login
- `POST /v1/auth/register` - User registration
- `GET /v1/auth/profile` - Get user profile

#### Cards
- `GET /v1/cards/daily` - Get daily coaching cards
- `PATCH /v1/cards/:id/complete` - Complete a card
- `POST /v1/cards` - Create custom card

#### Analytics
- `GET /v1/analytics` - Get comprehensive analytics
- `GET /v1/analytics/life-score` - Get current life score
- `GET /v1/analytics/domain/:domain` - Get domain-specific analytics

#### Subscriptions
- `GET /v1/subscriptions` - Get subscription status
- `POST /v1/subscriptions/stripe/create-subscription` - Create Stripe subscription
- `POST /v1/subscriptions/stripe/cancel` - Cancel subscription

#### Notifications
- `POST /v1/notifications/register-device` - Register device for push notifications
- `POST /v1/notifications/test-notification` - Send test notification

#### Integrations
- `GET /v1/integrations/plaid/link-token` - Get Plaid link token for bank connections
- `GET /v1/integrations/google-calendar/auth-url` - Get Google Calendar auth URL

## Database Schema

The database uses PostgreSQL with the following main entities:
- Users
- Cards
- User Progress
- Achievements
- Activities
- Subscriptions

## Development

### Running Tests
```bash
npm run test
```

### Code Formatting
```bash
npm run format
```

### Linting
```bash
npm run lint
```

## Deployment

The backend is designed to be deployed to various platforms:
- Vercel
- Railway
- Render
- AWS ECS/EKS

## Contributing

1. Follow the existing code style
2. Write tests for new features
3. Update documentation as needed
4. Use conventional commits

## License

Â© 2024 LifeDeck. All rights reserved.