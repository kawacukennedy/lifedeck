openapi: 3.0.1
info:
  title: LifeDeck API
  description: AI-powered life optimization platform API
  version: 1.0.0
  contact:
    name: LifeDeck Support
    email: support@lifedeck.app

servers:
  - url: https://api.lifedeck.app/v1
    description: Production server
  - url: http://localhost:3000/v1
    description: Development server

security:
  - bearerAuth: []

paths:
  /auth/login:
    post:
      summary: User login
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 6
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  refresh_token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials

  /auth/register:
    post:
      summary: User registration
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - name
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 6
                name:
                  type: string
                  minLength: 2
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Validation error

  /cards/daily:
    get:
      summary: Get daily coaching cards
      tags: [Cards]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Daily cards retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  cards:
                    type: array
                    items:
                      $ref: '#/components/schemas/Card'
        '401':
          description: Unauthorized

  /cards/{id}/complete:
    patch:
      summary: Complete a coaching card
      tags: [Cards]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Card completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'
        '404':
          description: Card not found

  /analytics:
    get:
      summary: Get user analytics
      tags: [Analytics]
      security:
        - bearerAuth: []
      parameters:
        - name: timeframe
          in: query
          schema:
            type: string
            enum: [week, month, year]
            default: month
      responses:
        '200':
          description: Analytics data retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  progress:
                    $ref: '#/components/schemas/UserProgress'
                  insights:
                    type: array
                    items:
                      $ref: '#/components/schemas/Insight'
                  trends:
                    $ref: '#/components/schemas/Trends'
                  correlations:
                    type: array
                    items:
                      $ref: '#/components/schemas/Correlation'

  /analytics/life-score:
    get:
      summary: Get current life score
      tags: [Analytics]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Life score retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  lifeScore:
                    type: number
                    minimum: 0
                    maximum: 100

  /subscriptions:
    get:
      summary: Get user subscription
      tags: [Subscriptions]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Subscription retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'

  /subscriptions/stripe/create-customer:
    post:
      summary: Create Stripe customer
      tags: [Subscriptions]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Customer created
          content:
            application/json:
              schema:
                type: object
                properties:
                  customer:
                    type: object

  /subscriptions/stripe/create-subscription:
    post:
      summary: Create subscription
      tags: [Subscriptions]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - customerId
                - priceId
              properties:
                customerId:
                  type: string
                priceId:
                  type: string
      responses:
        '200':
          description: Subscription created
          content:
            application/json:
              schema:
                type: object

  /notifications/register-device:
    post:
      summary: Register device for push notifications
      tags: [Notifications]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - platform
              properties:
                token:
                  type: string
                platform:
                  type: string
                  enum: [ios, android, web]
      responses:
        '200':
          description: Device registered successfully

  /integrations/plaid/link-token:
    get:
      summary: Get Plaid link token
      tags: [Integrations]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Link token generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  link_token:
                    type: string

  /integrations/google-calendar/auth-url:
    get:
      summary: Get Google Calendar auth URL
      tags: [Integrations]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Auth URL generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  auth_url:
                    type: string

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        name:
          type: string
        subscriptionTier:
          type: string
          enum: [FREE, PREMIUM]
        joinDate:
          type: string
          format: date-time
        progress:
          $ref: '#/components/schemas/UserProgress'

    Card:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        actionText:
          type: string
        domain:
          type: string
          enum: [HEALTH, FINANCE, PRODUCTIVITY, MINDFULNESS]
        actionType:
          type: string
          enum: [QUICK, STANDARD, EXTENDED, HABIT, REFLECTION]
        priority:
          type: string
          enum: [LOW, MEDIUM, HIGH, URGENT]
        icon:
          type: string
        tips:
          type: array
          items:
            type: string
        benefits:
          type: array
          items:
            type: string
        status:
          type: string
          enum: [PENDING, COMPLETED, DISMISSED, SNOOZED, EXPIRED]
        aiGenerated:
          type: boolean
        isPremium:
          type: boolean
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
          nullable: true

    UserProgress:
      type: object
      properties:
        healthScore:
          type: number
          minimum: 0
          maximum: 100
        financeScore:
          type: number
          minimum: 0
          maximum: 100
        productivityScore:
          type: number
          minimum: 0
          maximum: 100
        mindfulnessScore:
          type: number
          minimum: 0
          maximum: 100
        lifeScore:
          type: number
          minimum: 0
          maximum: 100
        currentStreak:
          type: integer
          minimum: 0
        longestStreak:
          type: integer
          minimum: 0
        lifePoints:
          type: integer
          minimum: 0
        totalCardsCompleted:
          type: integer
          minimum: 0

    Insight:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [correlation, improvement, pattern, achievement]
        title:
          type: string
        description:
          type: string
        impact:
          type: string
          enum: [low, medium, high]

    Trends:
      type: object
      properties:
        dates:
          type: array
          items:
            type: string
            format: date
        values:
          type: array
          items:
            type: number
        trend:
          type: string
          enum: [up, down, stable]
        average:
          type: number
        changePercent:
          type: number

    Correlation:
      type: object
      properties:
        domains:
          type: array
          items:
            type: string
        correlation:
          type: number
          minimum: -1
          maximum: 1
        insight:
          type: string

    Subscription:
      type: object
      properties:
        id:
          type: string
        tier:
          type: string
          enum: [FREE, PREMIUM]
        status:
          type: string
          enum: [NOT_SUBSCRIBED, ACTIVE, EXPIRED, CANCELLED, PENDING_RENEWAL, IN_GRACE_PERIOD]
        startDate:
          type: string
          format: date-time
          nullable: true
        expiryDate:
          type: string
          format: date-time
          nullable: true
        autoRenewEnabled:
          type: boolean

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT